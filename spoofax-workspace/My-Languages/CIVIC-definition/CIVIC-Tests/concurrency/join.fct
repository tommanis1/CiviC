initialise-binding initialise-storing initialise-giving finalise-failing finalise-throwing multithread postpone-after-effect scope
  (collateral
     (bind
        ("printInt",
         allocate-variable
           (functions
              (tuples
                 ((values)*),
               values))),
      bind
        ("foo",
         allocate-variable
           (functions
              (tuples
                 ((values)*),
               values))),
      bind
        ("main",
         allocate-variable
           (functions
              (tuples
                 ((values)*),
               values)))),
   sequential
     (assign
        (bound
           ("printInt"),
         function closure
           (scope
              (match
                 (given,
                  tuple
                    (pattern closure
                       (bind
                          ("val",
                           allocate-initialised-variable
                             (values,
                              given))))),
               handle-return
                 (print
                    (assigned
                       (bound
                          ("val"))))))),
      assign
        (bound
           ("foo"),
         function closure
           (scope
              (match
                 (given,
                  tuple
                    ( )),
               handle-return
                 (scope
                    (collateral
                       ( ),
                     sequential
                       (( ),
                        scope
                          (bind
                             ("i",
                              allocate-initialised-variable
                                (integers,
                                 decimal-natural
                                   ("1"))),
                           while
                             (is-less
                                (assigned
                                   (bound
                                      ("i")),
                                 decimal-natural
                                   ("20")),
                              sequential
                                (apply
                                   (assigned
                                      (bound
                                         ("printInt")),
                                    tuple
                                      (assigned
                                         (bound
                                            ("i")))),
                                 assign
                                   (bound
                                      ("i"),
                                    integer-add
                                      (assigned
                                         (bound
                                            ("i")),
                                       decimal-natural
                                         ("1")))))),
                        return
                          (decimal-natural
                             ("0")))))))),
      assign
        (bound
           ("main"),
         function closure
           (scope
              (match
                 (given,
                  tuple
                    ( )),
               handle-return
                 (scope
                    (collateral
                       ( ),
                     sequential
                       (( ),
                        scope
                          (bind
                             ("t",
                              thread-activate thread-joinable postpone-after-effect supply
                                (assigned
                                   (bound
                                      ("foo")),
                                 tuple
                                   ( ))),
                           sequential
                             (effect
                                (thread-join
                                   (bound
                                      ("t"))),
                              apply
                                (assigned
                                   (bound
                                      ("printInt")),
                                 tuple
                                   (decimal-natural
                                      ("101"))),
                                 print("end")
                                      )))))))),
      apply
        (assigned
           (bound
              ("main")),
         tuple
           ( ))))